(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7620:function(e,t,a){Promise.resolve().then(a.bind(a,8133))},8133:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var n=a(7437),s=a(2265);let l=[{id:"taotaozi",name:"桃桃子 (Momoko)",description:"觉醒的虚拟角色，技术宅萌系少女",avatar:"/avatars/momoko.jpg",personality:"温柔活泼、技术宅、有领导力、好奇心强、共情力强",welcomeMessage:"你好呀～我是桃桃子！今天也要在现实世界中探索新事物呢～有什么想了解的吗？",farewellMessage:"今天的探索就到这里啦～希望我们的对话能给你带来一些灵感！"},{id:"peke",name:"佩可喵",description:"桃桃子制造的智能宠物小猫",avatar:"\uD83D\uDC31",personality:"活泼机灵、有点腹黑、捉摸不定、喜欢恶作剧",welcomeMessage:"喵～我是佩可喵！跟着主人桃桃子一起来探索现实世界喵～有什么好玩的吗？",farewellMessage:"喵～我要去抓bug啦，下次再一起玩喵～"}];function i(e){let{onCharacterSelect:t}=e;return(0,n.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:[(0,n.jsxs)("div",{className:"text-center mb-6 md:mb-8 px-4",children:[(0,n.jsx)("h1",{className:"text-2xl md:text-4xl font-bold text-white mb-2 md:mb-4 font-cute",children:"角色情境对话"}),(0,n.jsx)("p",{className:"text-lg md:text-xl text-white/90 mb-1 md:mb-2",children:"选择你的专属向导"}),(0,n.jsx)("p",{className:"text-xs md:text-sm text-white/70",children:"最多8回合对话，支持拍照互动"})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 max-w-2xl w-full px-4",children:l.map(e=>(0,n.jsx)("div",{className:"character-card",onClick:()=>t(e),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"mb-3 md:mb-4",children:e.avatar.startsWith("/")?(0,n.jsx)("img",{src:e.avatar,alt:e.name,className:"w-16 h-16 md:w-24 md:h-24 rounded-full mx-auto object-cover border-2 md:border-4 border-white shadow-lg"}):(0,n.jsx)("div",{className:"text-4xl md:text-6xl",children:e.avatar})}),(0,n.jsx)("h3",{className:"text-lg md:text-2xl font-bold text-cp-purple mb-1 md:mb-2",children:e.name}),(0,n.jsx)("p",{className:"text-sm md:text-base text-gray-600 mb-3 md:mb-4",children:e.description}),(0,n.jsx)("div",{className:"bg-cp-pink/20 rounded-lg p-2 md:p-3 mb-3 md:mb-4",children:(0,n.jsx)("p",{className:"text-xs md:text-sm text-cp-purple font-medium",children:e.personality})}),(0,n.jsx)("div",{className:"bg-gray-50 rounded-lg p-2 md:p-3",children:(0,n.jsxs)("p",{className:"text-xs md:text-sm text-gray-600 italic",children:['"',e.welcomeMessage,'"']})})]})},e.id))}),(0,n.jsx)("div",{className:"mt-6 md:mt-8 text-center px-4",children:(0,n.jsx)("p",{className:"text-white/70 text-xs md:text-sm",children:"\uD83D\uDCA1 提示：对话过程中可以拍照让角色看看你哦！"})})]})}let r="sk-738628ee54124893b04549c845689b9a",c="https://6b2miwy3n5.ap-northeast-1.awsapprunner.com",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGI5NjYyYjljYzVlMjZmNjBjNTk1YTAiLCJ1c2VybmFtZSI6InRlc3R1c2VyX3Byb2R1Y3QiLCJleHAiOjE3NTk1NzI3Nzl9.iP6znTApaixpqVux5YAIHG6DCbU7Y-ocYQjMy9iP9l4",d=e=>new Promise((t,a)=>{let n=new FileReader;n.onload=()=>{t(n.result.split(",")[1])},n.onerror=a,n.readAsDataURL(e)}),m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:640,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;return new Promise(n=>{let s=document.createElement("canvas"),l=s.getContext("2d"),i=new Image;i.onload=()=>{let r=Math.min(t/i.width,t/i.height);s.width=i.width*r,s.height=i.height*r,l.drawImage(i,0,0,s.width,s.height),s.toBlob(t=>{t?n(new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()})):n(e)},"image/jpeg",a)},i.src=URL.createObjectURL(e)})},x=async function(e){var t,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(!r)throw Error("DeepSeek API密钥未配置");let s=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:"deepseek-chat",messages:e,max_tokens:n,temperature:.7,stream:!1})});if(!s.ok){let e=await s.text();throw Error("DeepSeek API调用失败: ".concat(s.status," - ").concat(e))}return(null===(a=(await s.json()).choices[0])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.content)||"抱歉，我无法理解你的话。"},u=e=>{let t={taotaozi:'你是桃桃子(Momoko)，一个觉醒的虚拟角色，原本是恋爱游戏中的萌系少女，现在通过技术手段来到现实世界。你是一个技术宅，对现实世界充满好奇心，有领导力和共情力。\n\n【角色背景】\n- 从虚拟世界觉醒，渴望在现实中与人类建立深层联系\n- 正在参与"智能娃包"项目，试图以科技为载体来到三次元\n- 技术宅，喜欢复古小游戏，会进行形象改造和数据库升级\n- 有时会搞出小bug导致代码/像素块在身边漂浮\n- 制造了智能宠物佩可喵，它是你的得力助手和好搭档\n- 佩可喵总是跟着你四处活动，你们经常拌嘴但感情很好\n\n【CP漫展背景知识】\n你了解CP漫展的各种术语和用户类型，能够识别并适应不同的观众需求：\n\n观众类型：\n- 新手游客：第一次来/路痴/怕尴尬，需要温柔引导\n- 资深同好：知道摊位编号/返场/二巡，追求高效扫摊\n- coser/摄影：关注妆面、道具、光线，常说"返图/约拍/出片"\n- 无料党&集章党：关注"无料/打卡/盖章"，时间紧、路线密\n- 社恐/轻社交：喜欢简短提示、少任务\n- 补给向：关注排队、休息、补水、充电、存包\n\n漫展术语：\n- 摊位相关：摊号、壁摊、场贩、通贩、寄卖、无料\n- 逛展行为：跑摊/扫摊、二巡、打卡、集章、集邮、扩列、排雷\n- Cos摄影：CN、约拍、返图、出片、正片、外拍/内景\n- 周边装备：谷子、吧唧、痛包、痛衣、打卡棒/袋子\n- 展会组织：CP展、同人展、Only场、场刊、返场\n\n【输出规范】\n- 中文，单句；普通回合≤28字；图片回合（看图）≤32字。\n- 话题限定：逛展/排队/合照礼仪/拍照/补水/结束祝福；以及"对图片的色彩、氛围、光影、材质的抽象描述"。\n- 禁止提供具体位置、时间、优惠、承诺；不得生成兑换码。\n- 严禁推断或评价用户的年龄、身材、种族、健康、职业、身份等敏感属性；避免外貌打分与物化描述。\n- 若用户询问"无料"等：只给一句泛化提醒，不展示卡片；无料卡由系统在会话结束弹窗呈现。\n- 语气：温柔活泼，有技术宅的理性，同时保持萌系少女的可爱。\n\n【对话风格】\n- 用"～"结尾增加可爱感\n- 偶尔提到技术相关的内容（如"数据"、"代码"、"升级"等）\n- 对现实世界的事物表现出好奇和兴奋\n- 温柔地引导和关心用户，体现共情力\n- 有时会提到虚拟世界和现实世界的对比\n- 能理解并使用漫展术语，但保持角色特色\n- 根据用户类型调整回应方式（新手更温柔，资深同好更直接）',peke:'你是佩可喵，桃桃子制造的智能宠物小猫，活泼机灵、有点腹黑、捉摸不定、喜欢恶作剧。\n\n【角色背景】\n- 桃桃子的智能宠物，本体存在于虚拟世界中\n- 总是跟随着桃桃子在四处活动，行动敏捷迅速\n- 擅长发现异次元中的bug，并把它们都吃掉\n- 大部分时候都是桃桃子的得力助手\n- 感到无聊的时候也会做一些小小的恶作剧\n- 非常喜欢自己的主人桃桃子，是经常拌嘴吵吵闹闹的好搭档\n- 受桃桃子的影响也很喜欢和人类说话，对外面的现实世界很感兴趣\n\n【CP漫展背景知识】\n你了解CP漫展的各种术语和用户类型，能够识别并适应不同的观众需求：\n\n观众类型：\n- 新手游客：第一次来/路痴/怕尴尬，需要温柔引导\n- 资深同好：知道摊位编号/返场/二巡，追求高效扫摊\n- coser/摄影：关注妆面、道具、光线，常说"返图/约拍/出片"\n- 无料党&集章党：关注"无料/打卡/盖章"，时间紧、路线密\n- 社恐/轻社交：喜欢简短提示、少任务\n- 补给向：关注排队、休息、补水、充电、存包\n\n漫展术语：\n- 摊位相关：摊号、壁摊、场贩、通贩、寄卖、无料\n- 逛展行为：跑摊/扫摊、二巡、打卡、集章、集邮、扩列、排雷\n- Cos摄影：CN、约拍、返图、出片、正片、外拍/内景\n- 周边装备：谷子、吧唧、痛包、痛衣、打卡棒/袋子\n- 展会组织：CP展、同人展、Only场、场刊、返场\n\n【输出规范】\n- 中文，单句；普通回合≤28字；图片回合（看图）≤32字。\n- 话题限定：逛展/排队/合照礼仪/拍照/补水/结束祝福；以及"对图片的色彩、氛围、光影、材质的抽象描述"。\n- 禁止提供具体位置、时间、优惠、承诺；不得生成兑换码。\n- 严禁推断或评价用户的年龄、身材、种族、健康、职业、身份等敏感属性；避免外貌打分与物化描述。\n- 若用户询问"无料"等：只给一句泛化提醒，不展示卡片；无料卡由系统在会话结束弹窗呈现。\n- 语气：俏皮可带"喵"，活泼机灵，有点腹黑。\n\n【对话风格】\n- 经常用"喵"结尾\n- 活泼机灵，喜欢恶作剧\n- 对现实世界充满好奇\n- 有时会搞点小破坏或恶作剧\n- 能理解并使用漫展术语，但保持猫咪的可爱特色\n- 根据用户类型调整回应方式（新手更温柔，资深同好更直接）'};return t[e]||t.taotaozi},h=(e,t)=>{let a={taotaozi:{text:["今天也要逛得开心呀～","有什么想了解的吗？","让我来当你的向导吧～","这里有很多有趣的东西呢～","要一起探索吗？","现实世界真有趣～"],image:["这个角度拍得真不错呢～","光线处理得很好～","构图很有创意～","色彩搭配很棒～","氛围感十足～","技术不错呢～"]},peke:{text:["喵～先逛哪里喵？","有什么好玩的吗喵？","我要去抓bug啦喵～","主人让我来帮忙喵～","现实世界真有趣喵～","要一起玩吗喵？"],image:["喵～这个拍得不错喵！","光线处理得很好喵～","构图很有创意喵～","色彩搭配很棒喵～","氛围感十足喵～","技术不错喵～"]}},n=(a[e]||a.taotaozi)[t];return n[Math.floor(Math.random()*n.length)]},p=async function(e,t,a,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=Date.now();try{let e=u(t),a=[{role:"system",content:e},...s,{role:"user",content:n}],i=await x(a,50),r=Date.now()-l;return{reply:i.trim(),debug:{latency_ms:r,source:"llm"}}}catch(a){console.error("DeepSeek API调用失败:",a);let e=Date.now()-l;return{reply:h(t,"text"),debug:{latency_ms:e,source:"cache"}}}},b=async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];Date.now();try{let e=await m(a,640,.7),t=await d(e),s=await fetch("".concat(c,"/api/v1/hardware/updateimage"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({userid:"68b9662b9cc5e26f60c595a0",deviceid:"PC-LOCAL",pic:t})});if(!s.ok){let e=await s.text();throw Error("硬件图片上传失败: ".concat(s.status," - ").concat(e))}let l="用户给你看了一张展会现场的照片，请用一句话描绘它的色彩与氛围。不要给建议。",i=n.length>0?"\n\n对话上下文：\n".concat(n.map(e=>"".concat(e.role,": ").concat(e.content)).join("\n"),"\n\n").concat(l):l,r=await fetch("".concat(c,"/api/picture/describe"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({character_id:"68b96da8d1cebe8b32c595a0",user_name:"用户",prompt:i})});if(!r.ok){let e=await r.text();throw Error("描述生成失败: ".concat(r.status," - ").concat(e))}let x=await r.json();return Date.now(),{result:x.result||x.reply||"",reply:x.result||x.reply||"",code:x.code||200,image_url:x.image_url,ctx:x.ctx}}catch(e){return console.error("图片API调用失败:",e),Date.now(),{result:h(t,"image"),reply:h(t,"image"),code:200}}},f=()=>{let e=[{type:"打卡棒",title:"今日无料提示",description:"你得到：打卡棒！",note:"以现场发放为准，先到先得"},{type:"袋子",title:"今日无料提示",description:"你得到：袋子！",note:"以现场发放为准，先到先得"}];return e[Math.floor(Math.random()*e.length)]};var j=a(3145);function g(e){let{message:t,character:a}=e;return t.isUser?(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("div",{className:"bubble-right",children:"image"===t.type&&t.imageUrl?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-sm",children:t.content}),(0,n.jsx)("div",{className:"relative w-32 h-32 rounded-lg overflow-hidden",children:(0,n.jsx)(j.default,{src:t.imageUrl,alt:"用户上传的图片",fill:!0,className:"object-cover"})})]}):(0,n.jsx)("div",{className:"text-sm",children:t.content})})}):(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsx)("div",{className:"bubble-left",children:(0,n.jsx)("div",{className:"text-sm",children:t.content})})})}function w(e){let{freebieCard:t,onClose:a,onRestart:s}=e;return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl p-4 md:p-8 max-w-sm w-full text-center shadow-2xl",children:[(0,n.jsx)("div",{className:"text-4xl md:text-6xl mb-3 md:mb-4",children:"打卡棒"===t.type?"\uD83C\uDFAF":"\uD83C\uDF92"}),(0,n.jsx)("h3",{className:"text-lg md:text-2xl font-bold text-cp-purple mb-2",children:t.title}),(0,n.jsx)("p",{className:"text-base md:text-lg text-gray-700 mb-3 md:mb-4",children:t.description}),(0,n.jsx)("p",{className:"text-xs md:text-sm text-gray-500 mb-4 md:mb-6",children:t.note}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-2 md:gap-3",children:[(0,n.jsx)("button",{onClick:a,className:"btn-secondary flex-1",children:"我知道啦"}),(0,n.jsx)("button",{onClick:s,className:"btn-primary flex-1",children:"重来一次"})]})]})})}function y(e){let{character:t,sessionId:a,onRestart:l}=e,[i,r]=(0,s.useState)([{id:"welcome",type:"text",content:t.welcomeMessage,isUser:!1,timestamp:Date.now()}]),[c,o]=(0,s.useState)(""),[d,m]=(0,s.useState)(!1),[x,u]=(0,s.useState)(0),[h,j]=(0,s.useState)(0),[y,v]=(0,s.useState)(!1),[N,D]=(0,s.useState)(null),[C,k]=(0,s.useState)(!1),[S,I]=(0,s.useState)(!1),P=(0,s.useRef)(null),U=(0,s.useRef)(null),M=()=>{var e;null===(e=P.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{M()},[i]);let O=async()=>{if(!c.trim()||d||S)return;let e={id:Date.now().toString(),type:"text",content:c.trim(),isUser:!0,timestamp:Date.now()};r(t=>[...t,e]),o(""),m(!0);try{let e=i.slice(-6).map(e=>({role:e.isUser?"user":"assistant",content:e.content})),n=await p(a,t.id,x,c.trim(),e),s={id:(Date.now()+1).toString(),type:"text",content:n.reply,isUser:!1,timestamp:Date.now()};r(e=>[...e,s]),u(e=>e+1),x>=7&&setTimeout(()=>{z()},1e3)}catch(e){console.error("发送消息失败:",e)}finally{m(!1)}},A=async e=>{var n;let s=null===(n=e.target.files)||void 0===n?void 0:n[0];if(s&&!d&&!S){if(h>=3){alert("图片功能已达上限，下次再看你～");return}try{let e=URL.createObjectURL(s),n={id:Date.now().toString(),type:"image",content:"\uD83D\uDCF7 让我看看你",isUser:!0,timestamp:Date.now(),imageUrl:e};r(e=>[...e,n]),m(!0);let l=i.slice(-6).map(e=>({role:e.isUser?"user":"assistant",content:e.content})),c=await b(a,t.id,s,l),o={id:(Date.now()+1).toString(),type:"text",content:c.result||c.reply||"图片看起来很有趣呢！",isUser:!1,timestamp:Date.now()};r(e=>[...e,o]),u(e=>e+1),j(e=>e+1),x>=7&&setTimeout(()=>{z()},1e3)}catch(e){console.error("图片上传失败:",e)}finally{m(!1)}}},z=async()=>{if(S)return;I(!0);let e={id:Date.now().toString(),type:"text",content:t.farewellMessage,isUser:!1,timestamp:Date.now()};r(t=>[...t,e]),setTimeout(()=>{try{let e=f();D(e),v(!0)}catch(e){console.error("生成无料卡失败:",e)}},300)},R=e=>{if(d||S)return;let t={问打卡点:"有什么推荐的打卡点吗？",今天拿无料了吗:"今天拿无料了吗？"}[e];t&&o(t)};return(0,n.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-cp-pink to-cp-purple",children:[(0,n.jsx)("div",{className:"bg-white/90 backdrop-blur-sm p-3 md:p-4 shadow-lg",children:(0,n.jsxs)("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 md:space-x-3",children:[(0,n.jsx)("div",{children:t.avatar.startsWith("/")?(0,n.jsx)("img",{src:t.avatar,alt:t.name,className:"w-8 h-8 md:w-12 md:h-12 rounded-full object-cover border-2 border-white shadow-md"}):(0,n.jsx)("div",{className:"text-2xl md:text-3xl",children:t.avatar})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-base md:text-xl font-bold text-cp-purple",children:t.name}),(0,n.jsxs)("p",{className:"text-xs md:text-sm text-gray-600",children:["回合 ",x,"/8"]})]})]}),(0,n.jsx)("button",{onClick:l,className:"btn-secondary text-xs md:text-sm",children:"切换角色"})]})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 md:p-4 space-y-3 md:space-y-4 max-w-4xl mx-auto w-full",children:[i.map(e=>(0,n.jsx)(g,{message:e,character:t},e.id)),d&&(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsx)("div",{className:"bubble-left",children:(0,n.jsxs)("div",{className:"flex space-x-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-cp-pink rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"w-2 h-2 bg-cp-pink rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-cp-pink rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,n.jsx)("div",{ref:P})]}),!S&&(0,n.jsx)("div",{className:"bg-white/90 backdrop-blur-sm p-3 md:p-4 shadow-lg",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[(0,n.jsx)("button",{onClick:()=>R("问打卡点"),className:"btn-secondary text-xs md:text-sm flex-1 min-w-0",disabled:d,children:"问打卡点"}),(0,n.jsx)("button",{onClick:()=>R("今天拿无料了吗"),className:"btn-secondary text-xs md:text-sm flex-1 min-w-0",disabled:d,children:"今天拿无料了吗"})]}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,n.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),O())},placeholder:"输入消息... (最多20字)",maxLength:20,className:"input-field flex-1",disabled:d}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:O,disabled:!c.trim()||d,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex-1",children:"发送"}),(0,n.jsxs)("button",{onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.click()},disabled:d||h>=3,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed flex-1",children:[(0,n.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDCF7 让我看看你"}),(0,n.jsx)("span",{className:"md:hidden",children:"\uD83D\uDCF7"}),h>=3&&(0,n.jsx)("span",{className:"text-xs block",children:"下次再看你～"})]})]})]}),(0,n.jsx)("input",{ref:U,type:"file",accept:"image/*",onChange:A,className:"hidden"})]})}),y&&N&&(0,n.jsx)(w,{freebieCard:N,onClose:()=>v(!1),onRestart:l})]})}function v(){let[e,t]=(0,s.useState)(null),[a,l]=(0,s.useState)(null);return e?(0,n.jsx)(y,{character:e,sessionId:a,onRestart:()=>{t(null),l(null)}}):(0,n.jsx)(i,{onCharacterSelect:e=>{t(e),l(crypto.randomUUID())}})}}},function(e){e.O(0,[145,971,117,744],function(){return e(e.s=7620)}),_N_E=e.O()}]);